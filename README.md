# gridsome-transformer-docutils

[![Build Status](https://travis-ci.com/vberlier/gridsome-transformer-docutils.svg?branch=master)](https://travis-ci.com/vberlier/gridsome-transformer-docutils)
[![npm](https://img.shields.io/npm/v/gridsome-transformer-docutils.svg)](https://www.npmjs.com/package/gridsome-transformer-docutils)

> Docutils transformer for Gridsome.

This transformer parses [docutils xml documents](http://docutils.sourceforge.net/docs/ref/doctree.html) with [docutils-parser](https://github.com/vberlier/docutils-parser). This lets you load documentation generated by tools like [sphinx](http://www.sphinx-doc.org) as a Gridsome data source.

## Installation

You can install `gridsome-transformer-docutils` with your `npm` client of choice.

```bash
$ npm install --save-dev gridsome-transformer-docutils
```

## Usage

After installing the package as a development dependency, you can configure [@gridsome/source-filesystem](https://github.com/gridsome/gridsome/tree/master/packages/source-filesystem) to load your generated xml files.

```js
// gridsome.config.js

module.exports = {
  plugins: [
    {
      use: '@gridsome/source-filesystem',
      options: {
        path: 'sphinx/**/*.xml',
        typeName: 'SphinxDocument',
        route: '/:slug'
      }
    }
  ]
}
```

### Configuration

You can configure the transformer globally and/or for a specific filesystem source.

```js
// gridsome.config.js

module.exports = {
  transformers: {
    docutils: {
      // Global config
    }
  },
  plugins: [
    {
      use: '@gridsome/source-filesystem',
      options: {
        path: 'sphinx/**/*.xml',
        typeName: 'SphinxDocument',
        route: '/:slug',
        docutils: {
          // Local config
        }
      }
    }
  ]
}
```

#### Options

- `basePath`

  Defaults to `'/'`. Specifies the path from which the [`source`](#fields) field of each document should be resolved.

- `plugins`

  Defaults to `[]`. An array of plugins passed to [docutils-parser](https://github.com/vberlier/docutils-parser) when parsing documents.

### Fields

In addition to the fields exposed by default by the source filesystem plugin, the transformer provides the generated nodes with three brand new fields.

- `root`

  The object returned by parsing the `content` field with [docutils-parser](https://github.com/vberlier/docutils-parser).

- `source`

  Reflects the path name of the document's source attribute. For example, the `source` field will be `'hello'` if you have a document with the following source attribute:

  ```xml
  <document source=".../example-project/docs/introduction/hello.rst">
  ```

  The value of the `source` field depends on the configured `basePath`. Setting the `basePath` to `'docs/'` would yield `'introduction/hello'` instead. If the document was generated by sphinx, this would also usually match the path used for internal references to the document.

- `segments`

  An array containing the different path segments of the `source` field. The `segments` field is equal to `source.split('/')`. You can use it to route the document to the path generated by sphinx in order to keep internal references working:

  ```js
  {
    use: '@gridsome/source-filesystem',
    options: {
      path: 'sphinx/**/*.xml',
      typeName: 'SphinxDocument',
      route: '/:segments+'
    }
  }
  ```

  **⚠️ A [gridsome bug](https://github.com/gridsome/gridsome/issues/277) currently prevents this syntax from working correctly ⚠️**

## Contributing

Contributions are welcome. This project uses [jest](https://jestjs.io/) for testing.

```bash
$ npm test
```

The code follows the [javascript standard](https://standardjs.com/) style guide.

```bash
$ npm run lint
```

---

License - [MIT](https://github.com/vberlier/gridsome-transformer-docutils/blob/master/LICENSE)
